<div class="w-full h-full flex flex-col gap-2 bg-primary-50">
    <p-toolbar [style]="{ 'padding': '0' }">
        <ng-template #start>
            <p-button icon="pi pi-bars" text severity="contrast" (click)="visible = true" />
        </ng-template>
        <ng-template #center>
            <p-button id="title" icon="pi pi-folder-open" text severity="warn"
                label="{{this.process() ? (this.coachee() ? this.coachee()!.name + ' ' + this.coachee()!.surname  : '' ) : ''}} - Sesión {{this.session()?.session_number}}"
                (click)="showDialogNotes()" />
            <p-button icon="pi pi-stopwatch" label="{{this.session()?.duration_minutes}}'" severity="success"
                variant="text" />
        </ng-template>
        <ng-template #end>
            <p-button icon="pi pi-eye" text severity="contrast" (onClick)="changeHidden()" />
            <p-button icon="pi pi-window-maximize" text severity="info" (onClick)="toggleFullScreen()" />
            <p-button icon="pi pi-sign-out" text severity="danger" (onClick)="goCoachees()" />
        </ng-template>
    </p-toolbar>
    <app-coachee-profile [coachee]="this.coachee()" [(visible)]="this.visibleProfile"></app-coachee-profile>
    <p-dialog header="Notas Previas" [(visible)]="visibleNotes" position="top" draggable="false"
        [style]="{ width: '45rem' }">
        <div class="flex flex-col">
            <div class="py-1 flex flex-col">
                <span class="font-medium">Objetivo Proceso:</span>
                <span>{{this.process() ? this.process()!.goal : "- No definido -"}}</span>
            </div>
            <div class="py-1 flex flex-col">
                <span class="font-medium">Objetivo Anterior:</span>
                <span>{{this.process() ? (this.process()!.sessions && this.process()!.sessions[1] ?
                    this.process()!.sessions[1].goal : "- No existe-") : "- No existe -"}}</span>
            </div>
            <div class="py-1 flex flex-col">
                <span class="font-medium">Resumen Anterior:</span>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam optio est necessitatibus
                    perspiciatis ex quod odit rem qui incidunt, voluptas id fugiat corporis quo, sapiente, hic eos harum
                    illum voluptatibus!
                </p>
            </div>
            <div class="py-1 flex flex-col">
                <span class="font-medium">Planes de acción pendientes:</span>
                <ul class="list-inside list-disc">
                    <li>10/10 07/10 15:00 Reunión nuevo diseño</li>
                    <li>10/10 08/10 23:59 Decidir qué diseño nuevo se hace</li>
                </ul>
            </div>
            <div class="py-1 flex flex-col">
                <span class="font-medium">Etiquetas:</span>
                <ul class="list-inside list-disc">
                    <li>Ansioso, agotado, nervioso</li>
                    <li>Dinero, compromiso</li>
                </ul>
            </div>
            <div class="py-1 flex flex-col">
                <span class="font-medium">Ideas:</span>
                <ul class="list-inside list-disc">
                    <li>Idea 1</li>
                    <li>Idea 2</li>
                </ul>
            </div>
        </div>

        <div class="flex justify-end gap-2">
            <p-button label="Cerrar" (click)="visibleNotes = false" />
        </div>
    </p-dialog>
    <p-dialog id="emotions-dialog" header="Cuadro Emociones" [(visible)]="visibleEmotions" [modal]="true"
        [style]="{ width: '45rem' }">
        <p-table [value]="detailEmotions()" selectionMode="single" dataKey="id" scrollHeight="flex" id="emotions"
            [size]="'small'">
            <ng-template pTemplate="body" let-row let-rowIndex="rowIndex">
                <tr [pSelectableRow]="row">
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 0)">{{ row.col1 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 1)">{{ row.col2 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 2)">{{ row.col3 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 3)">{{ row.col4 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 4)">{{ row.col5 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 5)">{{ row.col6 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 6)">{{ row.col7 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 7)">{{ row.col8 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 8)">{{ row.col9 }}</td>
                    <td [attr.bgcolor]="colorsByZone(rowIndex, 9)">{{ row.col10 }}</td>
            </ng-template>
        </p-table>

        <div class="flex justify-end gap-2">
            <p-button label="Cerrar" (click)="visibleEmotions = false" />
        </div>
    </p-dialog>
    <p-drawer [(visible)]="visible" header="Info & Herramientas">
        <p-button class="w-full" icon="pi pi-face-smile" text label="Cuadro Emociones" severity="help"
            (onClick)="showDialogEmotions()" />
        <p-button class="w-full" icon="pi pi-id-card" text label="Perfil Coachee" (onClick)="showProfile()" />
        <p-divider />
        <p-button class="w-full" icon="pi pi-history" text label="Historial" severity="warn" />
        <ul class="list-none p-0 m-0">
            @for (session of process()?.sessions?.slice(1); track session.id) {
            <li class="ml-2 py-1">
                <a class="no-underline text-primary-700 hover:text-primary-500">S{{session.session_number}}:
                    {{session.goal || 'Sin objetivo definido'}}</a>
            </li>
            }
        </ul>
        <p-divider />
        <p-button class="w-full" icon="pi pi-wrench" text label="Herramientas" severity="secondary" />
        <ul>
            <li class="ml-2">Rueda de la Vida</li>
            <li class="ml-2">Valores</li>
            <li class="ml-2">Semana Ideal</li>
            <li class="ml-2">Test de Colores</li>
            <li class="ml-2">Ficha Objetivo</li>
        </ul>
        <p-divider />
        <p-button class="w-full" icon="pi pi-graduation-cap" text label="Píldoras Formativas" severity="success" />
        <ul>
            <li class="ml-2">Emociones Básicas</li>
            <li class="ml-2">Camino Autoestima</li>
            <li class="ml-2">REA</li>
        </ul>
        <p-divider />
        <h4 class="text-primary-700 font-semibold">
            <span class="pi pi-pencil mr-2"></span>Pizarra
        </h4>
        <ng-template #footer>
            <div class="flex items-center gap-2">
                <button pButton label="Terminar Sesión" icon="pi pi-sign-out" class="w-full" severity="danger" outlined>
                </button>
            </div>
        </ng-template>
    </p-drawer>
    <div class="w-full">
        <p-popover #op>
            <ng-template #content>
                <h4 class="font-medium pb-1">Definición de Objetivo</h4>
                <ul class="list-inside list-disc">
                    <li>M - Medible</li>
                    <li>A - Alcanzable</li>
                    <li>R - Realista</li>
                    <li>T - Definido en el Tiempo</li>
                    <li>E - Específico</li>
                    <li>S - Satisfactorio</li>
                </ul>
            </ng-template>
        </p-popover>
        <div class="w-full" [hidden]="!hidden">
            <label for="goal" class="block mb-1 font-medium">Objetivo <p-button icon="pi pi-info-circle" text
                    severity="info" [size]="'small'" (click)="op.toggle($event)" /></label>
            <input pInputText id="goal" class="w-full" value="Decidir siguiente paso">
        </div>
        <p-panel [hidden]="hidden">
            <ng-template #header>
                <span class="font-medium">Objetivo</span>
            </ng-template>
            <span>{{this.goal() ? this.goal() : '- No definido -'}}</span>
            <ng-template #icons>
                <p-button icon="pi pi-info-circle" text severity="info" [size]="'small'" (click)="op.toggle($event)" />
            </ng-template>
        </p-panel>
    </div>
    <div class="w-full flex flex-col">
        <div class="w-full" [hidden]="!hidden">

            <label for="details" class="block mb-1 font-medium">Desarrollo de la sesión <p-button
                    icon="pi pi-info-circle" text severity="info" [size]="'small'" /></label>
            <p-table [value]="detailOptions()" selectionMode="single" [(selection)]="selectedDetail" dataKey="id"
                scrollHeight="flex" id="details" [size]="'small'" disabled>
                <ng-template pTemplate="body" let-detail>
                    <tr [pSelectableRow]="detail">
                        <td [width]="'5%'">{{ detail.type }}</td>
                        <td>{{ detail.text }}</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <p-panel [hidden]="hidden">
            <ng-template #header>
                <span class="font-medium">Desarrollo de la sesión</span>
            </ng-template>
            <ul class="max-h-115 overflow-y-auto">
                @for (note of notes(); track $index) {
                <li>
                    {{note}}
                </li>
                }
            </ul>
            <ng-template #icons>
                <p-button icon="pi pi-info-circle" text severity="info" [size]="'small'" />
            </ng-template>
        </p-panel>
    </div>
    <div class="w-full mb-auto">
        <div class="w-full" [hidden]="!hidden">

            <label for="tasks" class="block mb-1 font-medium">Planes de Acción <p-button icon="pi pi-info-circle" text
                    severity="info" [size]="'small'" /></label>
            <p-table [value]="taskOptions()" selectionMode="single" [(selection)]="selectedTask" dataKey="id"
                scrollHeight="flex" id="tasks" [size]="'small'">
                <ng-template pTemplate="body" let-task>
                    <tr [pSelectableRow]="task">
                        <td>{{ task.text }}</td>
                        <td [width]="'15%'">{{ task.scheduled | date: 'dd/MM HH:mm'}}</td>
                        <td [width]="'5%'">{{ task.score + "/10"}}</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <p-panel [hidden]="hidden">
            <ng-template #header>
                <span class="font-medium">Planes de Acción</span>
            </ng-template>
            <ul>
                @for (task of tasks(); track $index) {
                <li>
                    {{task}}
                </li>
                }
            </ul>
            <ng-template #icons>
                <p-button icon="pi pi-info-circle" text severity="info" [size]="'small'" />
            </ng-template>
        </p-panel>
    </div>
    <div class="w-full" [hidden]="!hidden">
        <label for="input" class="block mb-1 font-medium">Introducir datos <p-button icon="pi pi-info-circle" text
                severity="info" [size]="'small'" /></label>
        <div class="flex flex-row justify-between">
            <p-selectbutton [options]="stateOptions" [ngModel]="value" optionLabel="label" optionValue="value"
                aria-labelledby="basic" />
            <div class="flex gap-1">
                <p-button icon="pi pi-tags" [rounded]="true" [outlined]="true" severity="success" />
                <p-button icon="pi pi-user" [rounded]="true" [outlined]="true" severity="warn" />
                <p-button icon="pi pi-face-smile" [rounded]="true" [outlined]="true" severity="help" />
            </div>
        </div>
        <div class="w-full mt-auto flex flex-row gap-2 items-center">
            <textarea id="input" rows="2" pTextarea class="w-full" placeholder="Escribe aquí"></textarea>
            <p-button icon="pi pi-send" [size]="'large'"></p-button>
        </div>
    </div>
    <p-panel [hidden]="hidden">
        <ng-template #header>
            <span class="font-medium">Introducir datos</span>
        </ng-template>
        <div class="w-full mt-auto flex flex-row gap-2 items-center">
            <textarea #textInput pTextarea id="input" rows="2" [autoResize]="true" class="w-full"
                placeholder="Escribe aquí" [value]="message()" (input)="onMessageChange($event)"
                (keydown.enter)="handleEnter($event, textInput)"></textarea>
            <p-button icon="pi pi-send" [size]="'large'" (onClick)="sendMessage(textInput)"
                (mousedown)="$event.preventDefault()"></p-button>
        </div>
        <!-- <div class="w-full mt-2 flex flex-row justify-between gap-2 items-center">
            <div class="flex gap-1">
                <input pInputText id="goal" placeholder="Fecha Hora">
                <p-inputNumber id="commitment" [min]="1" [max]="10" suffix="/10" placeholder="Compromiso" class="w-full"
                    inputStyleClass="w-full" />

            </div>
            <div>
                <p-button icon="pi pi-tags" [rounded]="true" [outlined]="true" severity="success" />
                <p-button icon="pi pi-user" [rounded]="true" [outlined]="true" severity="warn" />
                <p-button icon="pi pi-face-smile" [rounded]="true" [outlined]="true" severity="help" />
            </div>
        </div> -->
        <ng-template #icons>
            <div class="flex flex-row gap-4">
                <p-button label="Objetivo" [text]="this.selected !== 'O'" severity="help" [size]="'small'"
                    (mousedown)="$event.preventDefault()" (onClick)="this.selected='O'" />

                @if(this.session()?.is_grow){
                <div class="flex flex-row">
                    <p-button label="I" [text]="this.selected !== 'GI'" severity="secondary" [size]="'small'"
                        (mousedown)="$event.preventDefault()" (onClick)="this.selected='GI'" />
                    <p-button label="G" [text]="this.selected !== 'GG'" severity="info" [size]="'small'"
                        (mousedown)="$event.preventDefault()" (onClick)="this.selected='GG'" />
                    <p-button label="R" [text]="this.selected !== 'GR'" severity="warn" [size]="'small'"
                        (mousedown)="$event.preventDefault()" (onClick)="this.selected='GR'" />
                    <p-button label="O" [text]="this.selected !== 'GO'" severity="danger" [size]="'small'"
                        (mousedown)="$event.preventDefault()" (onClick)="this.selected='GO'" />
                    <p-button label="W" [text]="this.selected !== 'GW'" severity="contrast" [size]="'small'"
                        (mousedown)="$event.preventDefault()" (onClick)="this.selected='GW'" />
                </div>
                }@else{
                <p-button label="Nota" [text]="this.selected !== 'N'" severity="info" [size]="'small'"
                    (mousedown)="$event.preventDefault()" (onClick)="this.selected='N'" />
                }
                <p-button label="PdA" [text]="this.selected !== 'P'" severity="success" [size]="'small'"
                    (mousedown)="$event.preventDefault()" (onClick)="this.selected='P'" />
                <p-button icon="pi pi-info-circle" text severity="info" [size]="'small'"
                    (mousedown)="$event.preventDefault()" />
            </div>
        </ng-template>
    </p-panel>
</div>